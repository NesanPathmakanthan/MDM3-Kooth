import pandas as pd
import numpy as np
from datetime import datetime, timedelta
#  Parameters
n_users = 20
n_content = 100
topics = ["Anxiety", "LGBTQ+", "Neurodiversity", "Depression"]
content_types = ["Article", "Forum", "Article Comment", "Forum Comment"]

# Generate synthetic data
np.random.seed(42)

# Define a global pool of user IDs limited by n_users
user_pool = [f"SU{i}" for i in range(1, n_users + 1)]

# Define topic-based engagement patterns
topic_engagement = {
    "Anxiety": {"views_mean": 50, "comments_mean": 10},
    "LGBTQ+": {"views_mean": 30, "comments_mean": 8},
    "Neurodiversity": {"views_mean": 20, "comments_mean": 5},
    "Depression": {"views_mean": 40, "comments_mean": 7},
}

# Define topic-based content type probabilities
topic_content_type_probs = {
    "Anxiety": [0.2, 0.1, 0.4, 0.3],
    "LGBTQ+": [0.1, 0.1, 0.5, 0.3],
    "Neurodiversity": [0.1, 0.2, 0.3, 0.4],
    "Depression": [0.2, 0.1, 0.4, 0.3],
}

# Initialize data and ancestor content tracker
data = []
content_tracker = []  # Track existing content with type for ancestor selection

for i in range(n_content):
    # Randomly choose a topic
    topic = np.random.choice(topics, p=[0.3, 0.2, 0.2, 0.3])
    
    # Generate user ID from the limited user pool
    user_id = np.random.choice(user_pool)
    
    # Generate content type based on topic
    content_type = np.random.choice(content_types, p=topic_content_type_probs[topic])
    
    # Generate views and comments based on topic engagement patterns
    views = max(0, np.random.poisson(topic_engagement[topic]["views_mean"]))
    comments = max(0, np.random.poisson(topic_engagement[topic]["comments_mean"]))
    
    # Generate timestamps
    created_timestamp = datetime(2024, 9, 1) + timedelta(hours=np.random.randint(0, 720))
    moderated_timestamp = created_timestamp + timedelta(hours=np.random.randint(1, 48))
    
    # Generate ancestor content ID for comments
    if content_type in ["Article Comment", "Forum Comment"]:
        # Filter valid ancestors based on existing content
        valid_ancestors = [c["Content_Created_ID"] for c in content_tracker if c["Content_Type"] in ["Article", "Forum"]]
        ancestor_content_id = np.random.choice(valid_ancestors) if valid_ancestors else None
    else:
        ancestor_content_id = None
    
    # Add the new content to the tracker
    content_tracker.append({
        "Content_Created_ID": i + 1,
        "Content_Type": content_type,
    })
    
    # Add entry to data
    data.append({
        "Content_Created_ID": i + 1,
        "Created_Timestamp": created_timestamp,
        "Moderated_Timestamp": moderated_timestamp,
        "Service_User_ID": user_id,
        "Content_Topic": topic,
        "Content_Type": content_type,
        "Views": views,
        "Comments": comments,
        "Ancestor_Content_ID": ancestor_content_id,
    })

# Create DataFrame
df = pd.DataFrame(data)

# Save the DataFrame to a CSV file
file_path = "/Users/isobelbridge/Documents/mdm4/simulated_kooth_data.csv"
df.to_csv(file_path, index=False)

print(f"File saved to: {file_path}")
